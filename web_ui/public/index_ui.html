<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>리액트를 쓰기 위한 공감을 위한 문법~ 왜 쓰는지 공감하기 위해~ 학습용도로 이렇게 작성함.</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
<h1>시작 페이지</h1>
<div>
    시작할때 보이는 페이지
    <h1>로그인</h1>
    id : <input type="text" id="id"> <br>
    pw : <input type="password" id="pw"><br>
    <button id="loginBtn"> 로그인 </button>
</div>
<div>
    로그인 했을때 보여주는 페이지
    <h2>로그인 이후 보여주는 메뉴</h2>
    <a href="#" id="userCheck">user data확인용</a> <br>
    <a href="#" id="managerCheck">manager data확인용</a> <br>
    <a href="#" id="adminCheck">admin data확인용</a> <br>
</div>
<div>
    메뉴 누르면 변경되는 데이터 쪼가리 또는 디자인
</div>
<div id="message"></div>
<script>
   function loginHandling() {
        let id = document.querySelector('#id');
        let pw = document.querySelector('#pw');
        // console.log(id, pw);
        axios.post('http://192.168.0.5:8882/login', {
            username: id.value,
            password: pw.value
        })//자바 객체로 써도 자동으로 json으로 넘어가는 상황 {"username":"id","password":"pw"}
            .then(response => { //.then은 yes 상황
                // console.log(response.headers.authorization); //헤더에 넘기기로 했는데 authorizatiion을 대문자로 넘겼는데 소문자로 옴...
                //유지 선택 - 1. 메모리, 2. 쿠키, 3. 세션스토리지(휘발성저장소) 4. 로컬스토리지
                sessionStorage.au = response.headers.authorization; //이렇게 저장 --> 껏다키면 사라짐.
                // localStorage.au = response.headers.authorization;      //이렇게 저장 --> 껏다켜도 살아있음.
                document.querySelector('#message').innerHTML = "login 성공~~";

            })
            .catch( error => {  //예외인 상황
                console.log(error);
                document.querySelector('#message').innerHTML = "login 실패~~";
            });
        //로그인 UI를 비활성화 하거나, 숨김해야되는건데 너무 코드 길어지니까 밑에 처럼
        id.value = "";
        pw.value = "";
    }
    document.querySelector("#loginBtn").addEventListener("click", loginHandling);

    function userHandling() {
        axios.get('http://192.168.0.5:8882/api/jwt/user', {headers : {
        Authorization: sessionStorage.au}
        })
            .then(response => {
                console.log(response);
                document.querySelector('#message').innerHTML=response.data.message;
        })
            .catch(error => {
                document.querySelector('#message').innerHTML='로그인 필수다.';
                console.log(error);
        });
    }
    document.querySelector("#userCheck").addEventListener("click", userHandling);

    function managerHandling() {
        axios.get('http://192.168.0.5:8882/api/jwt/manager', {headers : {
                Authorization: sessionStorage.au}
        })
            .then(response => {
                console.log(response);
                document.querySelector('#message').innerHTML=response.data.message;
            })
            .catch(error => {
                document.querySelector('#message').innerHTML='로그인 필수-그냥 로그인이 아닌 manager로그인이 필수';
                console.log(error);
            });
    }
    document.querySelector("#managerCheck").addEventListener("click", managerHandling);

    function adminHandling() {
        axios.get('http://192.168.0.5:8882/api/jwt/admin', {headers : {
                Authorization: sessionStorage.au}
        })
            .then(response => {
                console.log(response);
                document.querySelector('#message').innerHTML=response.data.message;
            })
            .catch(error => {
                document.querySelector('#message').innerHTML='로그인 필수-admin로그인이 필수다.';
                console.log(error);
            });
    }
    document.querySelector("#adminCheck").addEventListener("click", adminHandling);
</script>
</body>
</body>
</html>